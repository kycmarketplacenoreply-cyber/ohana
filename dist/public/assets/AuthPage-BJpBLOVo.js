import{c as de,b as le,d as ce,r as a,j as e}from"./index-C2tIt-s8.js";import{u as m}from"./useMutation-DeI9UjZL.js";import{C as me,b as ue,c as pe,d as ge,a as he}from"./card-DJCSPeTy.js";import{B as d}from"./button-C81GguyF.js";import{I as i}from"./input-BEOhY1fC.js";import{L as r}from"./label-ChOMr0ET.js";import{T as xe,a as fe,b as H,c as K}from"./tabs-D2aOvyD-.js";import{D as W,d as _,a as G,b as $,c as Q}from"./dialog-BizqDAQ5.js";import{T as je}from"./textarea-CkUTnl3Y.js";import{u as we}from"./useTranslation-C15n0AW9.js";import{S as be}from"./shield-BSQIj7CQ.js";import{L as X}from"./lock-Cf-JRGp2.js";import{U as Ne}from"./Combination-ADDH1bYy.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Z=de("mail",ve);function Ae(){const{t:ye}=we(),[,L]=le(),{toast:n}=ce(),[l,u]=a.useState({email:"",password:"",twoFactorToken:""}),[c,h]=a.useState({username:"",email:"",password:""}),[x,ee]=a.useState(""),[f,p]=a.useState("email"),[se,te]=a.useState(!1),[ae,re]=a.useState(!1),[j,M]=a.useState(""),[q,R]=a.useState(!1),[oe,D]=a.useState("email"),[w,A]=a.useState(""),[b,U]=a.useState(""),[g,I]=a.useState(""),[N,J]=a.useState(""),[ie,V]=a.useState(!1),v=m({mutationFn:async s=>{const t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email,password:s.password,twoFactorToken:s.twoFactorToken,emailVerificationCode:s.emailVerificationCode})}),o=await t.json();if(!t.ok)throw new Error(o.message);return o},onSuccess:s=>{if(s.requiresTwoFactor){te(!0),re(s.canUseEmailCode||!1),n({title:"2FA Required",description:s.canUseEmailCode?"Use authenticator code or email code if you lost your device":"Please enter your authenticator code"});return}localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(s.user)),n({title:"Welcome back!",description:`Logged in as ${s.user.username}`}),L("/")},onError:s=>{n({variant:"destructive",title:"Login Failed",description:s.message})}}),y=m({mutationFn:async s=>{const t=await fetch("/api/auth/send-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),o=await t.json();if(!t.ok)throw new Error(o.message);return o},onSuccess:()=>{n({title:"Code Sent",description:"Check your email for the verification code"}),p("verify")},onError:s=>{n({variant:"destructive",title:"Failed",description:s.message})}}),C=m({mutationFn:async s=>{const t=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=await t.json();if(!t.ok)throw new Error(o.message);return o},onSuccess:s=>{localStorage.setItem("token",s.token),localStorage.setItem("user",JSON.stringify(s.user)),n({title:"Account Created!",description:"Welcome to KYC Marketplace"}),L("/")},onError:s=>{n({variant:"destructive",title:"Registration Failed",description:s.message})}}),S=m({mutationFn:async s=>{const t=await fetch("/api/auth/request-password-reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),o=await t.json();if(!t.ok)throw new Error(o.message);return o},onSuccess:()=>{n({title:"Check Email",description:"Password reset code sent to your email"}),D("reset")},onError:s=>{n({variant:"destructive",title:"Failed",description:s.message})}}),F=m({mutationFn:async()=>{if(g!==N)throw new Error("Passwords do not match");const s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:b,newPassword:g})}),t=await s.json();if(!s.ok)throw new Error(t.message);return t},onSuccess:()=>{n({title:"Success!",description:"Password reset successfully. You can now login."}),V(!1),D("email"),A(""),U(""),I(""),J("")},onError:s=>{n({variant:"destructive",title:"Failed",description:s.message})}}),[ne,B]=a.useState(!1),[k,E]=a.useState(""),[P,Y]=a.useState(""),[T,z]=a.useState(""),O=m({mutationFn:async s=>{const t=await fetch("/api/support/anonymous",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=await t.json();if(!t.ok)throw new Error(o.message||"Failed to submit support request");return o},onSuccess:()=>{n({title:"Support request sent",description:"Our team will contact you via email."}),B(!1),E(""),Y(""),z("")},onError:s=>{n({variant:"destructive",title:"Failed",description:s.message})}});return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-3 sm:p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-primary rounded-xl",children:e.jsx(be,{className:"h-7 sm:h-8 w-7 sm:w-8 text-primary-foreground"})})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground truncate",children:"KYC Marketplace"}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mt-2",children:"Secure peer-to-peer trading"})]}),e.jsxs(me,{className:"border-border bg-card/50 backdrop-blur",children:[e.jsxs(ue,{children:[e.jsx(pe,{className:"text-foreground",children:"Get Started"}),e.jsx(ge,{children:"Sign in or create an account to start trading"})]}),e.jsx(he,{children:e.jsxs(xe,{defaultValue:"login",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(H,{value:"login","data-testid":"tab-login",children:"Login"}),e.jsx(H,{value:"register","data-testid":"tab-register",children:"Register"})]}),e.jsx(K,{value:"login",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault();const t={...l};q&&j&&(t.emailVerificationCode=j,t.twoFactorToken=""),v.mutate(t)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"login-email",className:"text-foreground",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"login-email","data-testid":"input-login-email",type:"email",placeholder:"Enter your email address",className:"pl-10 bg-muted border-border text-foreground",value:l.email,onChange:s=>u({...l,email:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"login-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"login-password","data-testid":"input-login-password",type:"password",placeholder:"Enter password",className:"pl-10 bg-muted border-border text-foreground",value:l.password,onChange:s=>u({...l,password:s.target.value})})]})]}),se&&e.jsx("div",{className:"space-y-3",children:q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"email-code",className:"text-foreground",children:"Email Code"}),e.jsx(i,{id:"email-code","data-testid":"input-email-code",placeholder:"Enter code from email",className:"bg-muted border-border text-foreground",value:j,onChange:s=>M(s.target.value)})]}),e.jsx(d,{type:"button",variant:"outline",className:"w-full text-sm",onClick:()=>{R(!1),M("")},"data-testid":"button-back-to-authenticator",children:"Back to authenticator code"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"2fa-token",className:"text-foreground",children:"Authenticator Code"}),e.jsx(i,{id:"2fa-token","data-testid":"input-2fa-token",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:l.twoFactorToken,onChange:s=>u({...l,twoFactorToken:s.target.value})})]}),ae&&e.jsx(d,{type:"button",variant:"outline",className:"w-full text-sm",onClick:()=>{R(!0),u({...l,twoFactorToken:""})},"data-testid":"button-use-email-code",children:"Lost your authenticator? Use email code instead"})]})}),e.jsx(d,{type:"submit","data-testid":"button-login",className:"w-full",disabled:v.isPending,children:v.isPending?"Signing in...":"Sign In"}),e.jsxs("div",{className:"text-center",children:[e.jsxs(W,{open:ie,onOpenChange:V,children:[e.jsx(_,{asChild:!0,children:e.jsx(d,{variant:"link",className:"text-sm p-0","data-testid":"button-forgot-password",children:"Forgot Password?"})}),e.jsxs(G,{className:"max-w-md",children:[e.jsx($,{children:e.jsx(Q,{className:"text-foreground",children:"Reset Password"})}),oe==="email"?e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email address and we'll send you a code to reset your password."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"forgot-email",className:"text-foreground",children:"Email Address"}),e.jsx(i,{id:"forgot-email",type:"email",placeholder:"Enter your email",className:"bg-muted border-border",value:w,onChange:s=>A(s.target.value),"data-testid":"input-forgot-password-email"})]}),e.jsx(d,{className:"w-full",onClick:()=>S.mutate(w),disabled:!w||S.isPending,"data-testid":"button-send-reset-code",children:S.isPending?"Sending...":"Send Reset Code"})]}):e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the reset code from your email and your new password."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"reset-code",className:"text-foreground",children:"Reset Code"}),e.jsx(i,{id:"reset-code",placeholder:"Enter reset code",className:"bg-muted border-border",value:b,onChange:s=>U(s.target.value),"data-testid":"input-reset-code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"new-pwd",className:"text-foreground",children:"New Password"}),e.jsx(i,{id:"new-pwd",type:"password",placeholder:"Enter new password",className:"bg-muted border-border",value:g,onChange:s=>I(s.target.value),"data-testid":"input-reset-new-password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"confirm-pwd",className:"text-foreground",children:"Confirm Password"}),e.jsx(i,{id:"confirm-pwd",type:"password",placeholder:"Confirm new password",className:"bg-muted border-border",value:N,onChange:s=>J(s.target.value),"data-testid":"input-reset-confirm-password"})]}),e.jsx(d,{className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>F.mutate(),disabled:!b||!g||!N||F.isPending,"data-testid":"button-confirm-reset-password",children:F.isPending?"Resetting...":"Reset Password"})]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(W,{open:ne,onOpenChange:B,children:[e.jsx(_,{asChild:!0,children:e.jsx(d,{variant:"link",className:"text-sm p-0",onClick:()=>E(l.email),children:"Contact Support"})}),e.jsxs(G,{className:"max-w-md",children:[e.jsxs($,{children:[e.jsx(Q,{className:"text-foreground",children:"Contact Support"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"If your account is frozen, submit this form and our support team will assist you."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"support-email",className:"text-foreground",children:"Your Email"}),e.jsx(i,{id:"support-email",type:"email",className:"bg-muted border-border",value:k,onChange:s=>E(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"support-subject",className:"text-foreground",children:"Subject"}),e.jsx(i,{id:"support-subject",className:"bg-muted border-border",value:P,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"support-message",className:"text-foreground",children:"Message"}),e.jsx(je,{id:"support-message",className:"bg-muted border-border",value:T,onChange:s=>z(s.target.value)})]}),e.jsx(d,{className:"w-full",onClick:()=>O.mutate({email:k,subject:P,message:T}),disabled:!k||!P||!T||O.isPending,children:O.isPending?"Sending...":"Send to Support"})]})]})]})})]})]})}),e.jsxs(K,{value:"register",children:[f==="email"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),y.mutate(c.email)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"register-email",className:"text-foreground",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"register-email","data-testid":"input-register-email",type:"email",placeholder:"Enter your email",className:"pl-10 bg-muted border-border text-foreground",value:c.email,onChange:s=>h({...c,email:s.target.value}),required:!0})]})]}),e.jsx(d,{type:"submit","data-testid":"button-send-code",className:"w-full",disabled:y.isPending,children:y.isPending?"Sending...":"Send Verification Code"})]}),f==="verify"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),p("create")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"text-foreground",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the code sent to ",c.email]}),e.jsx("div",{className:"relative",children:e.jsx(i,{"data-testid":"input-verification-code",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:x,onChange:s=>ee(s.target.value.replace(/\D/g,"").slice(0,6)),required:!0})})]}),e.jsx(d,{type:"submit","data-testid":"button-verify-code",className:"w-full",disabled:x.length!==6,children:"Continue"}),e.jsx(d,{type:"button",variant:"outline",className:"w-full",onClick:()=>p("email"),children:"Back"})]}),f==="create"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),C.mutate({...c,verificationCode:x})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"register-username",className:"text-foreground",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"register-username","data-testid":"input-register-username",placeholder:"Choose username",className:"pl-10 bg-muted border-border text-foreground",value:c.username,onChange:s=>h({...c,username:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"register-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(i,{id:"register-password","data-testid":"input-register-password",type:"password",placeholder:"Create password",className:"pl-10 bg-muted border-border text-foreground",value:c.password,onChange:s=>h({...c,password:s.target.value}),required:!0})]})]}),e.jsx(d,{type:"submit","data-testid":"button-register",className:"w-full",disabled:C.isPending,children:C.isPending?"Creating account...":"Create Account"}),e.jsx(d,{type:"button",variant:"outline",className:"w-full",onClick:()=>p("verify"),children:"Back"})]})]})]})})]})]})})}export{Ae as default};
